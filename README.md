# GCA_QuPathLayerAnnotations
A repo for Python, Groovy (Java) and R code used in analysis of data extracted from QuPath annotations, pixel classifiers and in-built positive cell and density mapping functions. 

## Scripts
NOTE: Numbers before each script file correspond to the raw data that the file generated. Files with number '00' are general files used within QuPath software or QuPath project folder in order to perform certain scripted functions.

| File name | Purpose |
| --- | --- |
| 00-1.imageNameRename.py | This script is required to be used within the QuPath project file. It simplifies the image file names in order to allow for annotation export and import to different project folder, as the name of the annotation file and the image file name must match |
| 00-2.exportAnnotations.groovy | Script used within QuPath to export generated annotations as .txt or .geojson files |
| 00-3.importAnnotations.groovy | Script used within QuPath to import generated annotations from .txt or .geojson files |
| 00-4.mucosaCorrection.groovy | Script used within QuPath, loads "Mucosa_detection_PSR.json" (for PSR staining) or "Mucosa_detection_IHC.json" (for IHC stains) pixel classifiers in order to correct the mucosa layer for all the empty space between villi |
| 00-5.exportImages.groovy | Script used within QuPath to export loaded images as original but scaled down in size, with annotations embedded in the image and finally classified with the collagen classifier |
| 00-6.exportAnnotationsAsImage.groovy | Script used within QuPath to export annotations as images |
| 01-1.CollagenQuantification.groovy | Script used within QuPath to run the "PSR_triple_high.json" pixel classifier to detect collagen, whitespace and other features within each annotated layer for each image within project. Output of the file creates a folder with a .csv file for each of the image present in a project folder |
| 01-2.collateCollagenAnnotationData.py | Python script to collate all the data files generated by "01-1.CollagenQuantification.groovy" script into a single .csv file |
| 01-3.statisticsCollagen.Rmd | R Markdown file with all the R code that allows for statistical analysis and generation of plots from the collated file generated by "01-2.collateCollagenAnnotationData.py" script. |
| 02-1.PositiveCellDetection.groovy | Script used within QuPath for immunohistochemistry images to extract the positive cell detection function data for each annotation and export as .csv files |
| 02-2.collatePositiveCellsAnnotations.py | Pythin script to collate all the data files generated by "02-1.PositiveCellDetection.groovy" script into a single .csv file |
| 02-3.sumRegionAreaIHC.py | Additional Python script to sum up the area of all annotations for each image to acquire the total area of each section |
| 02-4.statisticsPositiveCells.Rmd | R Markdown with all the R code that allows for statistical analysis and generation of plots from the collated file generated by "02-2.collatePositiveCellsAnnotations.py" script. |
| 03.statisticsLymphoidAggregateWhole.Rmd | R Markdown with all the R code that analyses the lymphoid aggregate data for whole image, generated by QuPath's in-built "Density Map" function |
| 04.statisticsLymphoidAggregateLayers | R Markdown with all the R code that analyses the lymphoid aggregate data for each annotations (layer), generated by QuPath's in-built "Density Map" function |